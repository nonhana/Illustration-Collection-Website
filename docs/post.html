<!DOCTYPE html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>上传</title>
	<link rel="stylesheet" href="../css/header.css">
	<style type="text/css">
		.fileItem_display {
			width: 200px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.fileItem_display img {
			width: 200px;
		}

		.inputbox {
			width: 300px;
			height: 40px;
			border-radius: 10px;
			padding: 0 10px;
			border: 0.5px #ff8200 solid;
			background-color: #f5f5f5;
		}

		#illustrator_postform {
			position: relative;
			width: 800px;
			background-color: #fff;
			margin: 30px auto 0;
			border-radius: 10px;
			box-shadow: 4px 4px 10px 0px rgba(0, 0, 0, 0.3);
			padding: 20px 0 20px 0;
		}

		#illustrator_postform>* {
			width: 500px;
			margin-top: 20px;
			margin-left: 100px;
			display: flex;
			align-items: center;
			justify-content: space-between;
		}

		#illustrator_postform font {
			font-family: SourceHanSansCN-Medium;
			font-size: 16px;
			font-weight: 500;
			line-height: 16px;
		}

		#picture_postform {
			position: relative;
			width: 800px;
			background-color: #fff;
			margin: 30px auto 0;
			border-radius: 10px;
			box-shadow: 4px 4px 10px 0px rgba(0, 0, 0, 0.3);
			padding: 20px 0 20px 0;
		}

		#picture_postform>* {
			width: 500px;
			margin-top: 20px;
			margin-left: 100px;
			display: flex;
			align-items: center;
			justify-content: space-between;
		}

		#picture_postform font {
			font-family: SourceHanSansCN-Medium;
			font-size: 16px;
			font-weight: 500;
			line-height: 16px;
		}

		#submitillustrator {
			margin-left: 600px;
			width: 70px;
			height: 40px;
			background-color: #ff8200;
			border-radius: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
			cursor: pointer;
		}

		#submitillustrator font {
			font-family: SourceHanSansCN-Medium;
			font-size: 18px;
			font-weight: 500;
			line-height: 17px;
			color: #fff;
		}

		#submitpicture {
			margin-left: 600px;
			width: 70px;
			height: 40px;
			background-color: #ff8200;
			border-radius: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
			cursor: pointer;
		}

		#submitpicture font {
			font-family: SourceHanSansCN-Medium;
			font-size: 18px;
			font-weight: 500;
			line-height: 17px;
			color: #fff;
		}
	</style>
</head>

<body>
	<div id="mainheader">
		<div id="mainlist">
			<font id="home">首页</font>
			<font id="pictures">插画列表</font>
			<font id="illustrator">画师列表</font>
			<font id="collection">最近收藏</font>
		</div>
		<div id="actions">
			<font style="color: #ff8200" id="post">上传</font>
			<font id="search">搜索</font>
		</div>
	</div>

	<div id="illustrator_postform">
		<font class="title" style="color: #ff8200">新增收藏画师</font>
		<div id="illustrator_name">
			<font>画师名称：</font>
			<input class="inputbox" type="text" placeholder="请输入画师名称">
		</div>
		<div id="illustrator_signal">
			<font>画师签名：</font>
			<input class="inputbox" type="text" placeholder="请输入画师签名">
		</div>
		<div id="illustrator_style">
			<font>画师风格：</font>
			<input class="inputbox" type="text" placeholder="请输入画师主要风格">
		</div>
		<div id="illustrator_SNS">
			<font>画师社交网站：</font>
			<input class="inputbox" type="text" placeholder="请输入画师主要社交网站url">
		</div>
		<div id="illustrator_reason">
			<font>收藏该画师理由：</font>
			<input class="inputbox" type="text" placeholder="收藏这位插画师，想必一定有一些特殊的理由吧">
		</div>
		<div id="illustrator_story">
			<font>该画师故事：</font>
			<input class="inputbox" type="text" placeholder="每一位画师的背后都会有一段发展史，查到了就写点吧">
		</div>
		<div id="illustrator_headpicture">
			<font>上传画师头像：</font>
			<input id="illustrator_fileItem" type="file">
			<div class="fileItem_display">
				<img id="illustrator_fileItem_display" src="" alt="">
			</div>
		</div>
		<div id="submitillustrator">
			<font>确认</font>
		</div>
	</div>

	<div id="picture_postform">
		<font class="title" style="color: #ff8200">新增收藏插画</font>
		<div id="picture_name">
			<font>插画名称：</font>
			<input class="inputbox" type="text" placeholder="请输入插画名称">
		</div>
		<div id="picture_labels">
			<font>插画标签：</font>
			<input class="inputbox" type="text" placeholder="请输入插画标签">
		</div>
		<div id="picture_illustrator">
			<font>插画画师名称：</font>
			<input class="inputbox" type="text" placeholder="请输入插画画师">
		</div>
		<div id="picture_originalurl">
			<font>插画原图地址：</font>
			<input class="inputbox" type="text" placeholder="请粘贴插画原图地址">
		</div>
		<div id="picture_date">
			<font>插画发布时间：</font>
			<input class="inputbox" type="text" placeholder="请输入插画发布时间(yy-mm-dd)">
		</div>
		<div id="picture_reason">
			<font>收藏该插画理由：</font>
			<input class="inputbox" type="text" placeholder="有什么特殊的感想就写下来吧">
		</div>
		<div id="picture_works">
			<font>上传插画文件：</font>
			<input id="picture_fileItem" type="file">
			<div class="fileItem_display">
				<img id="picture_fileItem_display" src="" alt="">
			</div>
		</div>
		<div id="submitpicture">
			<font>确认</font>
		</div>
	</div>
</body>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
	document.getElementById('home').addEventListener('click', function () {
		window.open("home.html");
	})
	document.getElementById('pictures').addEventListener('click', function () {
		window.open("pictures.html");
	})
	document.getElementById('illustrator').addEventListener('click', function () {
		window.open("illustrator.html");
	})
	document.getElementById('collection').addEventListener('click', function () {
		window.open("collection.html");
	})
	document.getElementById('post').addEventListener('click', function () {
		window.open("post.html");
	})
	document.getElementById('search').addEventListener('click', function () {
		window.open("search.html");
	})

	// 将上传的图片渲染到页面上实时显示
	document.querySelector('#illustrator_fileItem').onchange = function () {
		let picInfo = this.files[0];
		let url = URL.createObjectURL(picInfo)
		document.querySelector('#illustrator_fileItem_display').src = url;
	}
	document.querySelector('#picture_fileItem').onchange = function () {
		let picInfo = this.files[0];
		let url = URL.createObjectURL(picInfo)
		document.querySelector('#picture_fileItem_display').src = url;
	}

	// 点击提交按钮时，获取提交的表单
	document.getElementById('submitillustrator').addEventListener('click', function () {
		var illustrator_form = document.getElementById('illustrator_postform').getElementsByTagName('input');
		var submit_illustrator_form = {
			illustrator_name: "",
			illustrator_sign: "",
			illustrator_style: "",
			illustrator_SNS: "",
			illustrator_reason: "",
			illustrator_story: "",
			illustrator_head_photo: "",
		}
		var flag = 0;
		// console.log(illustrator_form)
		for (var i = 0; i < illustrator_form.length; i++) {
			if (illustrator_form[i].value == "") {
				flag = 1;
			}
		}
		if (flag == 0) {
			submit_illustrator_form.illustrator_name = illustrator_form[0].value;
			submit_illustrator_form.illustrator_sign = illustrator_form[1].value;
			submit_illustrator_form.illustrator_style = illustrator_form[2].value;
			submit_illustrator_form.illustrator_SNS = illustrator_form[3].value;
			submit_illustrator_form.illustrator_reason = illustrator_form[4].value;
			submit_illustrator_form.illustrator_story = illustrator_form[5].value;
			// 运用FileReader将图片转化为base64编码格式，便于字符串形式进行存储
			var reader = new FileReader();//声明FileReader对象
			reader.readAsDataURL(illustrator_form[6].files[0]);//进行转化
			// 注意：只能在onload函数中运用this.result将转化好的编码进行赋值！一旦离开onload函数则失效
			reader.onload = function () {
				submit_illustrator_form.illustrator_head_photo = this.result;
				axios({
					url: "http://localhost:8100/illustratorlist",
					method: 'POST',
					data: submit_illustrator_form,
				}).then(function (res) {
					alert("上传成功")
				});
			}
		} else {
			alert("添加画师的资料尚未填充完整！")
		}
	})

	// 上传插画
	document.getElementById('submitpicture').addEventListener('click', function () {
		var picture_form = document.getElementById('picture_postform').getElementsByTagName('input');
		var submit_picture_form = {
			picture_name: "",
			picture_labels: "",
			picture_creator: "",
			picture_origin: "",
			picture_time: "",
			picture_reason: "",
			picture_file: "",
		}
		var flag = 0;
		// console.log(picture_form)
		for (var i = 0; i < picture_form.length; i++) {
			if (picture_form[i].value == "") {
				flag = 1;
			}
		}
		if (flag == 0) {
			submit_picture_form.picture_name = picture_form[0].value;
			submit_picture_form.picture_labels = picture_form[1].value;
			submit_picture_form.picture_creator = picture_form[2].value;
			submit_picture_form.picture_origin = picture_form[3].value;
			submit_picture_form.picture_time = picture_form[4].value;
			submit_picture_form.picture_reason = picture_form[5].value;
			// 运用FileReader将图片转化为base64编码格式，便于字符串形式进行存储
			var reader = new FileReader();//声明FileReader对象
			reader.readAsDataURL(picture_form[6].files[0]);//进行转化
			// 注意：只能在onload函数中运用this.result将转化好的编码进行赋值！一旦离开onload函数则失效
			reader.onload = function () {
				submit_picture_form.picture_head_photo = this.result;
				axios({
					url: "http://localhost:8100/picturelist",
					method: 'POST',
					data: submit_picture_form,
				}).then(function (res) {
					alert("上传成功")
				});
			}
		} else {
			alert("添加插画的资料尚未填充完整！")
		}
	})
</script>

</html>